# Freifunk-Client-VPN
######################

function is_self_clientvpn() {
  return net ~ [fdef:ffc0:3dd7:10::/64+, 2001:bf7:110:10::/64+, 2001:67c:2d50:10::/64+];
}

protocol static local_clientvpn {
  route fdef:ffc0:3dd7:10::/64 via "freifunk-client";
  route 2001:bf7:110:10::/64 via "freifunk-client";
  route 2001:67c:2d50:10::/64 via "freifunk-client";
}

protocol ospf OSPF {
  rfc1583compat yes;
  import where is_self_net() && !is_self_mesh() && !is_self_clientvpn();
  export where is_self_net() || is_ula() || is_default();

  area 10.130.16.0 {
    interface "freifunk-client" {
      type broadcast;
    };
  };
};

# DN42 peerings
################

template bgp bgp_dn42 {
  table peering;
  local as OWNAS;
  import where is_ula() && !is_self_net();
  export where !is_default();
}

include "bird6_ibgp.conf";
include "bird6_icvpn.conf";
include "bird6_bgp.conf";
include "bird6_dn42.conf";
